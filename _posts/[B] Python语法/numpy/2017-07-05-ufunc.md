---
layout: post
title: 【Python】【numpy】ufunc.
categories:
tags: Python语法
keywords:
description:
order: 1102
---



ufunc是对ndarray执行运算的函数，用矢量化运算的方法极大的提高运算效率。  

## numpy内置的ufunc

### 1个输入值的内置ufunc

|函数|说明|
|--|--|
|abs|绝对值|
|sqrt|比a**0.5快|
|exp||
|log,log10,log2||
|sign||
|ceil|向上取整|
|floor|向下取整|
|rint|四舍五入|
|isnan||
|isfinite||
|isinf||
|sin,sinh,cos,cosh,tan,tanh||
|arcsin,arccos,arctan,arcsinh,arccosh,arctanh||

### 2个输入值的内置ufunc

#### 符号运算  


```python
a+b
a-b
a*b
a/b
a//b #商
a%b  #余数
#1. a,b是同样shape的ndarray
#2. b可以是数字
#3. b可以是1个元素的ndarray,如np.array([2])

b=a.T#转置
np.linalg.inv(a)#取逆
```

#### 布尔运算

- 生成bool
```python
x==y
x!=y
x<y
x<=y
x>y
x>=y
```

- bool运算：
```python
&#与
~#非
|#或
^#异或
```


注意：
- 实际上`&~|^`是按位运算符，因为与array.dtype=bool的情况下，与逻辑运算效果完全相同，所以可以这么用
- and和or等逻辑运算符不能直接对array使用，因为他们只能用于True/False
- 非bool方式是取反,运算规则与C语言完全相同（有些编程技巧）
    - dtype=np.int32  `~0=-1`
    - dtype=np.int8   `~0=255`


#### np.any np.all

- np.any(a==b) and np.all(a>b)


#### 其它运算符

|函数|说明|
|--|--|
|maximum|a,b对应每项的最大值|
|minimum|a,b对应每项最小值|



## 自己构建ufunc

ufunc函数可以矢量化运算，提高运算效率，增加代码可读性


准备函数和数据：
```python
import numpy as np
#构建函数
def tri_func(x,a=1,b=0):
    x=x-int(x)
    if x<0.3:
        y=x
    elif x<0.7:
        y=0.3
    else:
        y=1-x
    y=a*y+b
    return y
x=np.linspace(0,5,100000)
```

方式1：(指定函数的所有输入都是矢量化)
```python
func1=np.frompyfunc(tri_func,3,1)#把函数转为ufunc函数
#参数分别是func，nin输入参数数量，nout输出参数数量
y2=func1(x,1,0)

```

方式2：（非矢量参数a, b用tri_func的默认值）
```python
func1=np.frompyfunc(tri_func,1,1)
y2=func1(x)
```

结果分析：
```python
y2.dtyp#=object
y2=y2.astype(np.float)#转格式
```

### 广播计算

```python
def func1(x,y,c=0):
    return (x-1)**2+(y-1)**2+c
import numpy as np
func2=np.frompyfunc(func1,2,1)
x=np.linspace(0,2,5)
y=np.linspace(0,2,10).reshape(10,-1)
func1(x,y)
```
意思是，当shape不一致的array进行ufunc运算时，自动用repeat补齐

### reduce()
只对两个输入、一个输出的ufunc对象有效
