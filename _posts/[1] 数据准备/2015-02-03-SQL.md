---
layout: post
title: SQL语法速查.
categories:
tags: 1数据准备
keywords:
description:
order: 140
---


## 一、操作Database

### 创建数据库
```
CREATE DATABASE 数据库名 [其他选项];
```
例如：
```
CREATE DATABASE example_1;
```

### 显示数据库
```
SHOW DATABASES ;
```
### 删除数据库
```
DROP DATABASE example_1;
```
### 选择数据库
```
USE example;
```

## 二、操作Table
### 建表
```
CREATE TABLE 表名称(属性名 数据类型[约束条件]，属性名 数据类型[约束条件]);
```
 例子：
```
CREATE TABLE `fund_data` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
 `product_alias` varchar(64) NOT NULL DEFAULT '',
 `datetimes` varchar(64) NOT NULL DEFAULT '',
 `datas` varchar(64) NOT NULL DEFAULT '',
PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=691865 DEFAULT CHARSET=utf8;
```

#### 根据已有的表建新表
```
create table tab_new like tab_old
create table tab_new as select col1,col2… from tab_old definition only
```
### 显示表
```
show tables;
```

### 修改表名
```
alter table 旧表名 rename 新表名;
```

## 三、操作列
### 显示列
```
desc 表名;
describe 表名;
```

### 修改列属性
```
alter table 表名 modify 列名 新数据类型;
```

### 修改列名/列属性
```
alter table 表名 change 旧列名 新列名 新数据类型;
```

### 增加列
```
alter table 表名 add 列名 数据类型 [(first) after 列名2];
```

### 修改列顺序
```
alter table 表名 modify 列名1 数据类型 (first) after 列名2;
```

### 删除列
```
alter table 表名 drop 列名1;
```


### 设置外键
```
alter table 表名1  add constraint  键名  foreign key (id) references 主表 (id);
```

## 四、操作table中的数据

### 插入数据
```
insert [into] 表名 [(列名1, 列名2, 列名3, ...)] values (值1, 值2, 值3, ...);
```
例1：
```
insert into students values(NULL, "王刚", "男", 20, "13811371377");
```
例2：有时只需要插入部分数据
```
insert into students (name, sex, age) values("王刚", "男", 21);
```
例3：插入select出的数据
```
insert into table_name1(field1,field2,...,fieldn)
    select(field1,field2,...fieldn)
        from table_name2
            where ...
```
### 变更数据
```
update 表名称 set 列名1=取值1，列名2=取值2 where ...
```

### 删除数据
```
delete from 表名称 where...
```

例子：
删除id为2的行:
```
delete from students where id=2;
```
删除所有年龄小于21岁的数据:
```
delete from students where age<20;
```
删除表中的所有数据:
```
delete from students;
```

## 五、SELECT
基本用法是：
```
select 列名称 from 表名称 [查询条件];
```
详细用法：
```
select 列名称
from 表名
where 条件1
group by 列名 having 条件2
order by  列名 asc/desc;
```
条件：
```
in（值1，值2）      not in语句
between 取值1 and 取值2      not between and
like ‘字符串’（通配符：%表示多个字符或0个，_表示单个字符）
is null            is not null
条件1 and 条件2 and 条件3
条件1 or 条件2 or 条件3
```

选出不一样的
```
select distinct 列名 from…
select 字段1，group_concat(字段2) from 表1  group by 字段1
select 字段1，count(字段1 from 表1 group by  字段1
…with rollup  最后加一行总计
```

(只用于where的)
```
（is null：字段1 is null
is missing：字段1 is missing
contains：CONTAINS( 字段1, '"HEIBEI province" OR beijing' )
CONTAINS(*,'beijing')
）
```
group by 相关的汇总函数
```
count([distinct|all] 字段1)      sum   avg   max   min
```

给出名字
```
select 列名 as 显示列名 where...
```

### UNION
两个表并到一起，并且删掉重复内容
```
select field1,field2,...,from tablename1
UNION
select  field1,field2,...,from tablename2
UNION
select  field1,field2,...,from tablenamen
...
```

把UNION换成 UNION ALL，把两个表并到一起，不删除重复内容  
EXCEPT 差集，也就是在table1中，但不在table2中的结果。  
EXCEPT ALL表示不删除重复行  
INTERSECT 交集，表示同时出现在table1和table2中的结果  
INTERSECT ALL表示不删除重复行。  
注：差集和交集也可以用in来实现  


### 连接

- 笛卡尔积（CARTESIAN PRODUCT）  
- 内连接（INNER JOIN）：在笛卡尔积中，保留匹配的，舍去不匹配的。  
    - 自然连接（natural join）：对相同字段匹配
    - 等值连接：对等值匹配
    - 不等连接：对不等值匹配

- 外连接（outer join）：不但保留匹配，还保留一部分不匹配
    - 左外连接(left outer join)：保留匹配，还保留左边表的不匹配
    - 右外连接(right outer join)：保留匹配，还保留右边表的不匹配
    - 全外连接(full outer join)：保留匹配，保留左表、右表的不匹配
- 交叉连接


```
select field1 ,field2 ... ,fieldn
    from join_tablename1 inner join join_tablename2【inner join join_tablenamen】
    on joincondition;
```

三重内连接+别名
```
select e.empno,e.ename employeename,e.sal,e.job,l.ename loadername,d.dname,d.loc
    from t_employee e inner join t_tmployee l on e.mgr=l.empno
                inner join t_dept d on l.deptno=d.deptno;
```
以上可以用where的形式实现(更简单)
```
select e.empno,e.ename employeename,e.sal,e.job,l.ename loadername,d.dname,d.loc
    from t_employee e ,t_tmployee l ,t_dept d
    where  e.mgr=l.empno and l.deptno=d.deptno;
```

#### 外连接
内连接中的```join```改为```left|right|full [outer] join```即可

#### 超级分组和移动函数
grouping sets 没看太懂，https://www.cnblogs.com/woodytu/p/4685959.html  
rollup和cube，这里写的比较好 https://www.cnblogs.com/dyufei/archive/2009/11/12/2573974.html  
over
### 子查询
单行子查询
```
select enamel,sal,job
    from t_employee
    where(sal,job)=(
            select sal,job
                from t_employee
                where ename='smith');
```

多行单列
```
in（select...）
not in(select...)

=any(select)    功能与in一样
>any(select)     比最小的大
<any(select)     比最大的小

>all(select)     比最大的还大
<all(select)      比最小的还小
```



## 函数
### CASE
#### 简单Case

格式说明    
```
case 列名
    when   条件值1   then  选择项1
    when   条件值2    then  选项2.......
    else     默认值      
end
```
eg:
```
select
    case 　　job_level
        when     '1'     then    '1111'
        when　  '2'     then    '1111'
        when　  '3'     then    '1111'
        else       'eee'
    end
from dbo.employee
```

#### 复杂Case

格式说明    
```
case  
    when  列名= 条件值1   then  选择项1
    when  列名=条件值2    then  选项2.......
else
```
eg:
```
update  employee
set e_wage =
case
    when   job_level = '1'    then e_wage*1.97
    when   job_level = '2'   then e_wage*1.07
    when   job_level = '3'   then e_wage*1.06
    else     e_wage*1.05
end
```
### 类型转化函数

```
decimal, double, Integer, smallint,real  
Hex(arg):转化为参数的16进制表示。  
转化为字符串类型的：  
char, varchar  
Digits(arg):返回arg的字符串表示法，arg必须为decimal。  
转化为日期时间的：  
date, time,timestamp  
```

### 时间日期

```
year, quarter, month, week, day, hour, minute ,second  
dayofyear(arg)  
Dayofweek(arg)  
days(arg):返回日期的整数表示法，从0001-01-01来的天数。   
midnight_seconds(arg):午夜和arg之间的秒数。  
Monthname(arg):返回arg的月份名。  
Dayname(arg):返回arg的星期。  
```

### 字符串函数

```
length,lcase, ucase, ltrim , rtrim  
Coalesce(arg1,arg2….):返回参数集中第一个非null参数。  
Concat (arg1,arg2):连接两个字符串arg1和arg2。  
insert(arg1,pos,size,arg2):返回一个，将arg1从pos处删除size个字符，将arg2插入该位置。  
left(arg,length):返回arg最左边的length个字符串。  
locate(arg1,arg2,<pos>;):在arg2中查找arg1第一次出现的位置，指定pos，则从arg2的pos处开始找arg1第一次出现的位置。  
posstr(arg1,arg2):返回arg2第一次在arg1中出现的位置。  
repeat(arg1 ,num_times):返回arg1被重复num_times次的字符串。  
replace(arg1,arg2,arg3):将在arg1中的所有arg2替换成arg3。  
right(arg,length):返回一个有arg左边length个字节组成的字符串。  
space(arg):返回一个包含arg个空格的字符串。  
substr(arg1,pos,<length>;):返回arg1中pos位置开始的length个字符，如果没指定length，则返回剩余的字符。
```
### 数学函数

```
Abs
Ceil(arg):返回大于或等于arg的最小整数。
Floor(arg):返回小于或等于参数的最小整数。
ln,log10,log2,log(base,arg)
Mod(arg1,arg2):返回arg1除以arg2的余数，符号与arg1相同。
Rand():返回1到1之间的随机数。
Power(arg1,arg2):返回arg1的arg2次方。
Round(arg1,arg2):四舍五入截断处理，arg2是位数，如果arg2为负，则对小数点前的数做四舍五入处理。
Sigh(arg):返回arg的符号指示符。-1,0,1表示。
truncate(arg1,arg2):截断arg1，arg2是位数，如果arg2是负数，则保留arg1小数点前的arg2位。
```

### 聚合函数
```sql
count, max, min, sum
avg
var_pop, var_samp 方差和样本方差
stddev_pop, stddev_samp 偏差和样本偏差
covar_pop(col1,col2), vovar_samp 协方差和样本协方差
corr(col1,col2) 相关系数
count(DISTINCT col1) - 合适的函数，都可以接受DISTINCT
```

### 算术运算符
同C
```
+
-
*
/
%
```

### 比较运算符
全部都输出逻辑结果
```
>
<
!=
>=
<=
betwen and
is null
in
like            通配符匹配
regexp        正则表达式
    举例：‘cjgong’regexp 'g$' 返回1
    ^        匹配开始部分
    $        匹配结束部分
    .        匹配任意一个字符
    [字符集合]        匹配集合中的任意一个字符
    [^字符集合]        匹配集合中外的任意一个字符
    str1|str2|str3        匹配任意一个字符串
    *
    +
    字符串{N}            字符串出现N次
    字符串(M,N)        字符串出现至少M次，最多N次
```

### 逻辑运算符
（与C语言很像）
```
and(&&)
or(||)
not(!)
xor(异或)

位运算符（与C语言完全相同）
&
|
~
^
<<
>>
```

## 参考文献
mySQL从入门到精通  
https://wenku.baidu.com/view/f7f6e6dcd1f34693daef3e8b.html
