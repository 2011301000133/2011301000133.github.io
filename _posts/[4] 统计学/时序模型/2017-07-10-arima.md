---
layout: post
title: 【ARIMA】理论与实现.
categories:
tags: 4统计学
keywords:
description:
order: 443
---

*本文信息密度极高，请慢速阅读*  

平稳性检验通过后，Ljung-Box q检验拒绝白噪声假设，就可以使用本文的建模方法了。

ARMA模型的前提是数据平稳。  

## AR(p)模型
(Auto Regression Model)  
$AR(p):y_t=\phi_0+\phi_1 y_{t-1}+\phi_2 y_{t-2}+...+\phi_p y_{t-p}+\varepsilon_t$  
$\phi_p \neq 0$  
$E\varepsilon_t=0,Var(\varepsilon_t)=\sigma_\varepsilon^2,E(\varepsilon_t\varepsilon_s)=0,s\neq t$，也就是白噪声过程  
$Ex_s\varepsilon_t=0,\forall s<t$，也就是回归的自变量与残差无关。  


当$\phi_0=0$,称为中心化AR(p)模型  
附加条件序列平稳后，$Ex_t=\dfrac{\phi_0}{1-\phi_1-...-\phi_p}$  
可以把AR(p)中心化：$y_t=x_t-Ex_t$  


引入延迟算子，中心化AR(p)又可以记为：  
$\Phi(B)x_t=\varepsilon_t$  
其中，$\Phi(B)=1-\phi_1B-\phi_2B^2-...-\phi_pB^p$  


### 平稳
AR(p)模型本身不要求序列平稳，但往往平稳过程才能用于AR(p)的分析中。  
因此，使用AR之前，要判别序列是否平稳。  
序列平稳性方面的知识见于[另一篇文章](http://www.guofei.site/2017/12/04/timeseries.html)  
AR(p)平稳性判别有两种方法：
1. 特征根判别
2. 平稳域判别


#### 1. 特征根判别
$AR(p)$平稳的充要条件是它的p个特征根都在单位圆内。  
等价于自回归多项式$\Phi(B)=0$的根在单位圆外。  


（特征方程是这个：$\lambda^p-\phi_1 \lambda^{p-1}-\phi_2\lambda^{p-2}-...-\phi_p=0$  
它的根叫做特征根)  


#### 2. 平稳域判别
根据解的取值范围，判断系数$\phi$约束集合$$\{\phi_1,\phi_2,...\phi_p \mid$$特征根都在单位圆内}  


### AR(p)的性质
均值(如果平稳):$Ex_t=\dfrac{\phi_0}{1-\phi_1-...-\phi_p}$  
如果是中心化$AR(p)$，并且要求序列平稳的话，  
$r_k=\phi_1r_{k-1}+\phi_2 r_{k-2}+...+\phi_p r_{k-p}$  
(证明：$E(x_tx_{t-k})=\phi_1E(x_{t-1}x_{t-k})+...+\phi_pE(x_{t-p}x_{t-k}))+E(\varepsilon_t x_{t-k})$)  
（附加平稳性条件后，可以推导出AR(p)的ACF拖尾性）  


在AR(p)模型中，p阶PACF的值，实际上就是AR(p)第p项回归系数值。（根据PACF的定义推导）  


以AR(1),AR(2)为例：  
ACF:  
$AR(1):\rho_k=\phi_1^k$  
$$AR(2):\rho_k=\left \{ \begin{array}{cc}
1&k=0 \\
\dfrac{\phi_1}{1-\phi_2}&k=1\\
\phi_1\rho_{k-1}+\phi_2\rho_{k-2}&k\geq 2
\end{array}\right.$$  
PACF:  
$$AR(1):\rho_k=\left \{ \begin{array}{cc}
\phi_1&k=0 \\
0&k\geq 1
\end{array}\right.$$  
$$AR(2):\rho_k=\left \{ \begin{array}{cc}
\dfrac{\phi_1}{1-\phi_2}&k=1 \\
\phi_2&k=2\\
0&k> 2
\end{array}\right.$$  




## MA(q)模型
(Moving Average Model)  
$MA(q):y_t=c+\varepsilon_t-\theta_1 \varepsilon_{t-1}-\theta_2 \varepsilon_{t-2}-...-\theta_q \varepsilon_{t-q}$  
其中，  
$\theta_q\neq 0$  
$E(\varepsilon_t)=0,D\varepsilon_t=\sigma_\varepsilon^2,E(\varepsilon_t\varepsilon_s)=0,s\neq t$（白噪声）  
当$c=0$,称为 **中心化MA(q)** 模型  


也可以写成：  
$y_t=\Theta(B)\varepsilon_t$  
$\Theta(B)=1-\theta_1B-\theta_2B^2-...-\Theta_qB^q$  


### MA的性质
常数均值$Ex_t=u$  
常数方差$Dx_t=(1+\theta_1^2+...+\theta_q^2)\sigma_\varepsilon^2$  
自协方差函数q阶截尾（证明提要：$Ex_sx_t$,滞后多于q不相关，少于q有限个相关）  


MA还有一个性质，同一组自相关和偏自相关系数，可以对应两个MA模型，定义其中一个叫做 **可逆的MA模型**。  
可逆MA模型的形式与AR类似，所以也可以使用单位根判别其是否是AR模型  
可逆MA模型可以转换成$AR(\infty)$  









## ARMA(p,q)模型
(Auto Regressioin Moving Average Model)  
$ARMA(p,q):y_t=c+\phi_1 y_{t-1}+\phi_2 y_{t-2}+...+\phi_p y_{t-p}+\varepsilon_t-\theta_1 \varepsilon_{t-1}-\theta_2 \varepsilon_{t-2}-...-\theta_q \varepsilon_{t-q}$
其中，  
$\phi_p\neq0,\theta_q\neq 0$  
$E(\varepsilon_t)=0,D\varepsilon_t=\sigma_\varepsilon^2,E(\varepsilon_t\varepsilon_s)=0,s\neq t$（白噪声）  
$Ex_s\varepsilon_t=0,\forall s<t$，也就是回归的自变量与残差无关。  


当$c=0$,称为中心化$ARMA(p,q)$模型  


**平稳性**：AR部分的自回归系数多项式$\Phi(B)=0$的根都在单位圆外  
**可逆性**：MA部分的移动平均系数多项式$\Theta(B)=0$的根都在单位圆外  


## p,d,q的确定

### d的识别
ARMA模型要求数据平稳，当数据不平稳时，需要差分。如果d阶差分后，序列平稳，叫做`d阶单整序列`  
如果差分很多次，还是不平稳。或者差分后已经失去研究意义了，那么就放弃ARIMA模型。  

### p,q的识别

||AR(p)|MA(q)|ARMA(p,q)|
|--|--|--|--|
|ACF|拖尾|q期后截尾|拖尾|
|PACF|p期后截尾|拖尾|拖尾|


识别的困难：  
由于样本的随机性，样本ACF,PACF不会呈现完美的理论截尾情况，而是在零值附近震荡，因此需要用统计学手段进行假设检验  


Barlett
:    $\hat\rho_k\sim N(0,1/n),n\to \infty$  


Quenouille
:    $\hat\phi_{kk}\sim N(0,1/n),n\to \infty$  


求出各自的95%置信区间:  
$Pr(-2/\sqrt n<\hat\rho_k<2/\sqrt n)>0.95$  
$Pr(-2/\sqrt n<\hat\phi_{kk}<2/\sqrt n)>0.95$  
以这个方法定阶：  
**d阶之前明显在落在置信区间外，d阶之后几乎95%落在置信区间内，并且d阶前后衰减非常突然，那么判断截尾阶数为d**  


## 参数估计
确定模型以及p,q后，有p+q+2个参数需要估计  
$\phi_1,...,\phi_p,\theta_1,...,\theta_q,u,\sigma_\varepsilon^2$  
1. 距估计
2. 极大似然估计
3. 最小二乘法





## ACF和PACF

### ACF

自相关系数ACF的定义：  
$r_k=\rho(y_t,y_{t-k})=\dfrac{cov(y_t,y_{t-k})}{\sqrt{var(y_t)var(y_{t-k})}}$  

计算公式是：  
$r_k=\dfrac{\sum\limits_{t=1}^{n-k}(Y_t-\bar Y)(Y_{t+k}-\bar Y)}{\sum\limits_{t=1}^n(Y_t-\bar Y)^2}$

ACF也是一个随机变量。当序列$\{ Y_t \}$是完全随机序列时，$ACF\sim N(0,1/\sqrt n )$

### PACF  

偏自相关系数PACF的定义：$Y_t$在给定$Y_{t-1},Y_{t-2},...Y_{t-k+1}$的条件下，$Y_t$与$Y_{t-k}$之间的条件相关。  
$\rho_{x_t,x_{t-k}\mid x_{t-1},...,x_{t-k+1}}=\dfrac{E(y_t-E y_t)E(y_{t-k}-E y_{t-k})}{E(y_{t-k}-E y_{t-k})^2}$  





计算方法：  
$$\left\{ \begin{array}{ccc}
\rho_1=\phi_{k1}\rho_0+\phi_{k2}\rho_1+...+\phi_{kk}\rho_{k-1}\\
\rho_2=\phi_{k1}\rho_1+\phi_{k2}\rho_0+...+\phi_{kk}\rho_{k-2}\\
.........................................\\
\rho_k=\phi_{k1}\rho_{k-1}+\phi_{k2}\rho_{k-2}+...+\phi_{kk}\rho_0\\
\end{array}\right.$$  
其中，$\phi$就是偏自相关系数，$\rho$是已经计算得到的自相关系数  


（另一本书上看到的计算方式）  
$$\phi_{kk} = \left \{ \begin{array}{ccc}
r_1,&&k=1\\
\dfrac{r_k-\sum\limits_{j=1}^{k-1} \phi_{k-1,j}\cdot r_{k-j}}{1-\sum\limits_{j=1}^{k-1}\phi_{k-1,j} \cdot r_j}&&k=2,3,...
\end{array}\right.$$  

其中，  
$\phi_{k-j}=\phi_{k-1,j}-\phi_{kk}\phi_{k-1,k-j}$  



## Python实现
`<iframe src="http://www.guofei.site/StatisticsBlog/arma.html" width="100%" height="3600em" marginwidth="10%"></iframe>`
