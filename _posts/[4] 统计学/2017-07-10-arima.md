---
layout: post
title: 【统计时序】ARIMA原理与实现.
categories:
tags: 4统计学
keywords:
description:
order: 435
---
## 工具
### 1. 差分
**一阶差分** $\nabla x_t=x_t-x_{t-1}$  
**p阶差分** $\nabla^p x_t=\nabla^{p-1} x_t-\nabla^{p-1} x_{t-1}$  
**k步差分** $\nabla_k=x_t-x_{t-k}$  
### 2. 延迟算子
相当于把当前序列值得时间向过去拨了1个时刻
$x_{t-p}=B^p x_t$,  


例如，$x_{t-1}=Bx_t,x_{t-2}=B^2x_t,$  
$\nabla^1 x_t=(1-B)x_t,\nabla^2x_t=(1-B)^2 x_t$  

#### 2-1. 延迟算子的性质
$B^0=1$  
$B(cx_t)=cBx_t$  
$B(x_t+y_t)=Bx_t+By_t$  
$B^n x_t=x_{t-n}$  
$(1-B)^n=\sum(-1)^n C_n^iB^i$  


$\nabla^p=(1-B)^px_t$  
$\nabla_k=(1-B^k)x_t$  
### 3. 线性差分方程
线性差分方程
: $z_t+a_1z_1+a_2z_2+...+a_pz_p=h(t)$  

齐次线性差分方程
: $z_t+a_1z_{t-1}+a_2z_{t-2}+...+a_pz_{t-p}=0$  


#### 3-1. 解齐次线性差分方程
step1：特征方程: $\lambda^p+a_1\lambda^{p-1}+a_2\lambda^{p-2}+...+a_p=0$  
step2：特征方程的根称为特征根，记为$\lambda_1,\lambda_2,...\lambda_p$  
step3：特征方程的通解为：  
不相等的实数根：$z_t=c_1\lambda_1^t+c_2\lambda_2+...+c_p\lambda_p^t$  
有相等的实数根：$z_t=(c_1+c_2t+...+c_dt^{d-1})\lambda_1^t+c_{d+1}^t+...+c_p\lambda_p^t$  
复根：$z_t=r^t(c_1e^{itw}+c_2e^{-itw})+c_3\lambda_3^t+...+c_p\lambda_p^t$  
#### 3-2. 解非齐次线性差分方程
求非齐次线性差分方程的任意特解$z_t''$  
求齐次线性差分方程的通解$z_t'$  
非齐次线性差分方程的通解为$z_t=z_t''+z_t'$  


## ARIMA(p,d,q)模型介绍

ARMA模型的前提是数据平稳。  

## AR(p)模型
(Auto Regression Model)  
$AR(p):y_t=\phi_0+\phi_1 y_{t-1}+\phi_2 y_{t-2}+...+\phi_p y_{t-p}+\varepsilon_t$  
$\phi_p \neq 0$  
$E\varepsilon_t=0,Var(\varepsilon_t)=\sigma_\varepsilon^2,E(\varepsilon_t\varepsilon_s)=0,s\neq t$，也就是白噪声过程  
$Ex_s\varepsilon_t=0,\forall s<t$，也就是回归的自变量与残差无关。  


当$\phi_0=0$,称为中心化AR(p)模型  
附加条件序列平稳后，$Ex_t=\dfrac{\phi_0}{1-\phi_1-...-\phi_p}$  
可以把AR(p)中心化：$y_t=x_t-Ex_t$  


引入延迟算子，中心化AR(p)又可以记为：  
$\Phi(B)x_t=\varepsilon_t$  
其中，$\Phi(B)=1-\phi_1B-\phi_2B^2-...-\phi_pB^p$  


### 平稳
AR(p)模型本身不要求序列平稳，但往往平稳过程才能用于AR(p)的分析中。  
AR(p)判别有两种方法：
1. 特征根判别
2. 平稳域判别


#### 1. 特征根判别
$AR(p)$平稳的充要条件是它的p个特征根都在单位圆内。  
等价于自回归多项式$\Phi(B)=0$的根在单位圆外。  


我的理解是这样，$AR(p):\Phi(B) X_t=\varepsilon_t$  
$\Phi(B)=0$的所有的根都要在单位圆外。  
(原因还没搞清楚)  
#### 2. 平稳域判别
根据解的取值范围，判断系数$\phi$约束  


### AR(p)的性质
均值(如果平稳):$Ex_t=\dfrac{\phi_0}{1-\phi_1-...-\phi_p}$  
### MA(q)模型
(Moving Average Model)  
$MA(q):y_t=c+\varepsilon_t+\theta_1 \varepsilon_{t-1}+\theta_2 \varepsilon_{t-2}+...+\theta_q \varepsilon_{t-q}$  

### ARMA(p,q)模型
(Auto Regressioin Moving Average Model)  
$ARMA(p,q):y_t=c+\phi_1 y_{t-1}+\phi_2 y_{t-2}+...+\phi_p y_{t-p}+\varepsilon_t+\theta_1 \varepsilon_{t-1}+\theta_2 \varepsilon_{t-2}+...+\theta_q \varepsilon_{t-q}$


## p,d,q的确定

### d的识别
ARMA模型要求数据平稳，当数据不平稳时，需要差分。如果d阶差分后，序列平稳，叫做`d阶单整序列`  
如果差分很多次，还是不平稳。或者差分后已经失去研究意义了，那么就放弃ARIMA模型。  

### p,q的识别

||AR(p)|MA(q)|ARMA(p,q)|
|--|--|--|--|
|ACF|拖尾|q期后截尾|拖尾|
|PACF|p期后截尾|拖尾|拖尾|

## ACF和PACF

### ACF

自相关系数ACF的定义：  
$r_k=\rho(y_t,y_{t-k})=\dfrac{cov(y_t,y_{t-k})}{\sqrt{var(y_t)var(y_{t-k})}}$  

计算公式是：  
$r_k=\dfrac{\sum\limits_{t=1}^{n-k}(Y_t-\bar Y)(Y_{t+k}-\bar Y)}{\sum\limits_{t=1}^n(Y_t-\bar Y)^2}$

ACF也是一个随机变量。当序列$\{ Y_t \}$是完全随机序列时，$ACF\sim N(0,1/\sqrt n )$

### PACF  

偏自相关系数PACF的定义：$Y_t$在给定$Y_{t-1},Y_{t-2},...Y_{t-k+1}$的条件下，$Y_t$与$Y_{t-k}$之间的条件相关。  

$$\phi_{kk} = \left \{ \begin{array}{ccc}
r_1,&&k=1\\
\dfrac{r_k-\sum\limits_{j=1}^{k-1} \phi_{k-1,j}\centerdot r_{k-j}}{1-\sum\limits_{j=1}^{k-1}\phi_{k-1,j} \centerdot r_j}&&k=2,3,...
\end{array}\right.$$  

其中，  
$\phi_{k-j}=\phi_{k-1,j}-\phi_{kk}\phi_{k-1,k-j}$  



## Python实现
`<iframe src="http://www.guofei.site/StatisticsBlog/arma.html" width="100%" height="3600em" marginwidth="10%"></iframe>`
